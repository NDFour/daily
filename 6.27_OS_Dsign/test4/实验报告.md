# 操作系统 -- 实验四实验报告

## 实验四：银行家算法的模拟与实现

### 一、实验题目

> 本实验的内容是要通过编写和调试一个模拟系统动态分配资源的银行家算法程序，有效地避免
> 死锁发生。 具体要求如下：
> （ 1） 初始化时让系统拥有一定的资源；
> （ 2） 用键盘输入的方式允许进程动态申请资源；
> （ 3） 如果试探分配后系统处于安全状态，则修改系统的资源分配情况，正式分配资源；
> （ 4） 如果试探分配后系统处于不安全状态，则提示不能满足请求，恢复原状态并阻塞该进程。

### 二、实验目的

> (1) 进一步了解进程的并发执行。
> (2) 加强对进程死锁的理解，理解安全状态与不安全状态的概念。
> (3) 掌握使用银行家算法避免死锁问题。

### 三、总体设计

> 当一进程提出资源申请时，银行家算法执行下列步骤以决定是否向其分配资源：
> 1）检查该进程所需要的资源是否已超过它所宣布的最大值。
> 2）检查系统当前是否有足够资源满足该进程的请求。
> 3）系统试探着将资源分配给该进程，得到一个新状态。
> 4）执行安全性算法，若该新状态是安全的，则分配完成；若新状态是不安全的，则恢复原状
> 态，阻塞该进程。

### 四、详细设计

#### 1. 数据结构：

> 1）可利用资源向量Available 　　
> 是个含有m个元素的数组，其中的每一个元素代表一类可利用的资源数目。如果Available[j]=K，则表示系统中现有Rj类资源K个。 　　
> 2）最大需求矩阵Max 　　
> 这是一个n×m的矩阵，它定义了系统中n个进程中的每一个进程对m类资源的最大需求。如果Max[i,j]=K，则表示进程i需要Rj类资源的最大数目为K。 
> 3）分配矩阵Allocation 　　
> 这也是一个n×m的矩阵，它定义了系统中每一类资源当前已分配给每一进程的资源数。如果Allocation[i,j]=K，则表示进程i当前已分得Rj类资源的 数目为K。 　　
> 4）需求矩阵Need。 　　
> 这也是一个n×m的矩阵，用以表示每一个进程尚需的各类资源数。如果Need[i,j]=K，则表示进程i还需要Rj类资源K个，方能完成其任务。 　　
> Need[i,j]=Max[i,j]-Allocation[i,j] 

#### 2. 算法流程图：

> 当一进程提出资源申请时，银行家算法执行下列步骤以决定是否向其分配资源：
> 1）检查该进程所需要的资源是否已超过它所宣布的最大值。
> 2）检查系统当前是否有足够资源满足该进程的请求。
> 3）系统试探着将资源分配给该进程，得到一个新状态。
> 4）执行安全性算法，若该新状态是安全的，则分配完成；若新状态是不安全的，则恢复原状
> 态，阻塞该进程。

Init 初始化算法流程图：

 ![Init初始化算法流程图](pics\Init初始化算法流程图.gif)

Bank 银行家算法流程图：

 ![Bank银行家算法流程图](pics\Bank银行家算法流程图.gif)

Safe 安全性算法流程图：

 ![Safe安全性算法流程图](pics\Safe安全性算法流程图.gif)

### 五、实验结果与分析

1. 程序运行结果：![运行结果](pics\运行结果.PNG)

2. 实验结果分析：

   在避免死锁的方法中，所施加的限制条件较弱，有可能获得令人满意的系统性能。在该方法中把系统的状态分为安全状态和不安全状态，只要能使系统始终都处于安全状态，便可以避免发生死锁。

   银行家算法的基本思想是分配资源之前, 判断系统是否是安全的; 若是, 才分配。它是最具有 代表性的避免死锁的算法。

   设进程cusneed 提出请求REQUEST [i] ，则银行家算法按如下规则进行判断。

   (1) 如果REQUEST [cusneed] [i]<= NEED[cusneed][i] ，则转(2) ；否则，出错。

   (2) 如果REQUEST [cusneed] [i]<= AVAILABLE[cusneed][i] ，则转(3) ；否则，出错。

   (3) 系统试探分配资源，修改相关数据：

   ```c++
        AVAILABLE[i]-=REQUEST[cusneed][i];
   ```

   ```c++
        ALLOCATION[cusneed][i]+=REQUEST[cusneed][i];
   ```

   ```c++
        NEED[cusneed][i]-=REQUEST[cusneed][i];
   ```

   (4) 系统执行安全性检查，如安全，则分配成立；否则试探险性分配作废，系统恢复 原状， 进程等待。

   ​


### 六、小结与心得体会